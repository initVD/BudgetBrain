{% extends 'base.html' %}

{% block content %}

<nav>
  <ul>
    <li><a href="{% url 'dashboard' %}">Back to Dashboard</a></li>
  </ul>
  <ul>
    <li title="Toggle dark/light mode">
      <label for="theme-switcher" style="margin-bottom: 0;">
        <input type="checkbox" id="theme-switcher" role="switch">
      </label>
    </li>
  </ul>
</nav>

{% if messages %}
  {% for message in messages %}
    <article {% if message.tags == 'success' %}style="background-color: var(--pico-color-green-100);"
             {% elif message.tags == 'error' %}style="background-color: var(--pico-color-red-100);"
             {% elif message.tags == 'warning' %}style="background-color: var(--pico-color-amber-100);"
             {% endif %}>
      {{ message }}
    </article>
  {% endfor %}
{% endif %}

<div class="grid">
  <article>
    <h3>Add a New Category</h3>
    <form method="post" action="{% url 'manage_categories' %}">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit">Save Category</button>
    </form>
  </article>

  <article>
    <h3>Retrain AI "Brain"</h3>
    <p>
      Click this button to force the AI to re-learn from all of your 
      manually categorized transactions.
    </p>
    <form action="{% url 'retrain_ai' %}" method="post">
      {% csrf_token %}
      <button type="submit">Retrain AI Now</button>
    </form>
  </article>
</div>

<article>
  <h3>Your Categories & Budgets</h3>

  <form method="post" action="{% url 'manage_categories' %}">
    {% csrf_token %}
    <figure>
      <table role="grid">
        <thead>
          <tr>
            <th scope="col">Category Name</th>
            <th scope="col">Monthly Budget Limit ($)</th>
            <th scope="col" style="width: 20%;">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for category in categories %}
            <tr>
              <td>{{ category.name }}</td>
              <td>
                <input 
                  type="number" 
                  step="0.01" 
                  name="budget_{{ category.id }}" 
                  value="{{ category.budget_limit|floatformat:2 }}">
              </td>
              <td>
                <button 
                  type="submit" 
                  name="update_category_id" 
                  value="{{ category.id }}">
                  Save Budget
                </button>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="3">You haven't added any categories yet.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </figure>
  </form>
</article>

{% endblock %}